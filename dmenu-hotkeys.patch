From 1429a54e2bfa641ac9eeffb851b0837e248ac5d3 Mon Sep 17 00:00:00 2001
From: milaq <micha.laqua@gmail.com>
Date: Wed, 19 Oct 2022 18:59:10 +0200
Subject: [PATCH] Use TAB as hotkey anchor

also add Shift-Insert to paste
---
 dmenu.c | 28 ++++++++++++++++++++--------
 1 file changed, 20 insertions(+), 8 deletions(-)

diff --git a/dmenu.c b/dmenu.c
index 5e694ec..ed54086 100644
--- a/dmenu.c
+++ b/dmenu.c
@@ -407,9 +407,28 @@ keypress(XKeyEvent *ev)
 		case XK_j: ksym = XK_Next;  break;
 		case XK_k: ksym = XK_Prior; break;
 		case XK_l: ksym = XK_Down;  break;
+		case XK_Tab:
+			puts((sel && !(ev->state & ShiftMask)) ? sel->text : text);
+			if (!(ev->state & ControlMask)) {
+				cleanup();
+				exit(0);
+			}
+			if (sel)
+				sel->out = 1;
+			break;
 		default:
 			return;
 		}
+	} else if (ev->state & ShiftMask) {
+		switch(ksym) {
+		case XK_ISO_Left_Tab:
+			ksym = XK_Up;
+			break;
+		case XK_Insert:
+			XConvertSelection(dpy, (ev->state & ShiftMask) ? clip : XA_PRIMARY,
+			                  utf8, utf8, win, CurrentTime);
+			return;
+		}
 	}
 
 	switch(ksym) {
@@ -509,19 +528,12 @@ insert:
 		/* fallthrough */
 	case XK_Down:
 	case XK_KP_Down:
+	case XK_Tab:
 		if (sel && sel->right && (sel = sel->right) == next) {
 			curr = next;
 			calcoffsets();
 		}
 		break;
-	case XK_Tab:
-		if (!sel)
-			return;
-		cursor = strnlen(sel->text, sizeof text - 1);
-		memcpy(text, sel->text, cursor);
-		text[cursor] = '\0';
-		match();
-		break;
 	}
 
 draw:
-- 
2.38.1

